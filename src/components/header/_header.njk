{% from "../button/_button.njk" import greatButton %}
{% from "../text-input/_text-input.njk" import textInput %}
{% from "./_masthead.njk" import greatMasthead %}

{% macro greatHeader(params) %}
<header class="great-header {{ params.header_classes }} {% if params.isInternational %}great-header--international{% endif %}" id="header" role="banner" data-ga-section="header">
    <div id="great-global-header" class="great-container great-header__global {{ params.global_header_classes }} {% if params.sso_is_logged_in %}signed-in{% endif %}">
        <div class="great-header__dbt-logo">
            {% if params.isInternational %}
                {{ greatMasthead({
                    isInternational: true
                }) }}
            {% else %}
                {{ greatMasthead() }}
            {% endif %}
        </div>
        <ul class="great-header__international-links">
            <li class="great-header__international-link-item {% if not params.isInternational %}great-header__international-link-item--active{% endif %} great-header__international-link-item--domestic">
                <a href="/" id="great-global-header-domestic-link" class="great-header__international-link">For UK businesses</a>
            </li>
            <li class="great-header__international-link-item great-header__international-link-item--international {% if params.isInternational %}great-header__international-link-item--active{% endif %}">
                <a href="/international/" id="great-global-header-international-link" class="great-header__international-link">For international businesses</a>
            </li>
        </ul>
    </div>
    <div class="great-header__main">
        <div class="great-header__main-inner great-container">
            <div class="great-header__logo-container">
                <a id="header-logo-link" alt="Great" class="great-header__great-logo" href="/">
                    <svg class="great-header__great-logo-image" width="200" height="99" viewBox="0 0 200 99" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M176.227 45.0524V23.8516L138.716 42.655H129.995L167.506 23.8516H125.775V45.0524H176.227Z" fill="white"/>
                        <path d="M176.227 78.3348V61.5527H125.681V71.3305L128.119 82.7536H176.227L138.716 63.9502H147.484L176.227 78.3348Z" fill="white"/>
                        <path d="M58.8176 28.2234V45.0524H109.27V23.8516H58.8176L96.3287 42.655H87.5605L58.8176 28.2234Z" fill="white"/>
                        <path d="M128.119 65.1719V82.7531H163.098L128.119 65.1719Z" fill="#04043F"/>
                        <path d="M176.227 42.6558V30.4336L151.845 42.6558H176.227Z" fill="#04043F"/>
                        <path d="M128.119 23.8516V41.3858L163.098 23.8516H128.119Z" fill="#04043F"/>
                        <path d="M151.845 63.9512L176.227 76.1734V63.9512H151.845Z" fill="#04043F"/>
                        <path d="M106.925 23.8516H71.9463L106.925 41.3858V23.8516Z" fill="#04043F"/>
                        <path d="M83.1999 42.6558L58.8176 30.4336V42.6558H83.1999Z" fill="#04043F"/>
                        <path d="M13.8979 90.9809H16.3831C17.8366 90.9809 18.5868 91.874 18.5868 92.9082C18.5868 93.6604 18.3055 94.1304 17.7897 94.4595C18.54 94.7415 19.0557 95.3056 19.0557 96.3398C19.0557 97.7031 18.0242 98.4552 16.4768 98.4552H13.8979V90.9809ZM16.3362 94.1774C17.1333 94.1774 17.6022 93.6603 17.6022 93.0022C17.6022 92.3911 17.1333 91.827 16.3362 91.827H14.8357V94.1774H16.3362ZM16.6175 97.5621C17.6022 97.5621 18.1179 97.045 18.1179 96.2928C18.1179 95.5877 17.6491 95.0236 16.6175 95.0236H14.8357V97.5621H16.6175ZM20.8844 90.9809H23.0882C24.5417 90.9809 25.4795 91.827 25.4795 93.0962C25.4795 93.9894 25.0106 94.8826 23.6977 95.1176L26.2766 98.4552H25.1044L22.6193 95.2116H21.8222V98.4552H20.8844V90.9809ZM23.0413 94.3185C24.0259 94.3185 24.4948 93.8484 24.4948 93.0962C24.4948 92.2971 23.9791 91.874 23.0413 91.874H21.8222V94.3655H23.0413V94.3185ZM27.7771 90.9809H28.7148V98.4552H27.7771V90.9809ZM32.2784 91.874H30.1684V90.9339H35.3731V91.874H33.2631V98.4082H32.3253V91.874H32.2784ZM38.5615 90.8868L42.1719 98.4552H41.1404L40.2026 96.4809H36.8266L35.8888 98.4552H34.8573L38.5615 90.8868ZM39.8275 95.5877L38.5615 92.9082L37.2955 95.5877H39.8275ZM43.5786 90.9809H44.5164V98.4552H43.5786V90.9809ZM47.7986 93.1433V98.4552H46.8608V90.8868L52.1593 96.2928V90.9809H53.0971V98.5492L47.7986 93.1433ZM69.2268 93.1433V98.4552H68.2891V90.8868L73.5875 96.2928V90.9809H74.5253V98.5492L69.2268 93.1433ZM76.2133 94.6945C76.2133 92.5321 77.9013 90.8868 80.0113 90.8868C82.1213 90.8868 83.8093 92.5321 83.8093 94.6945C83.8093 96.8569 82.1213 98.5022 80.0113 98.5022C77.9013 98.5022 76.2133 96.8569 76.2133 94.6945ZM82.8246 94.6945C82.8246 93.0492 81.6055 91.78 80.0113 91.78C78.3702 91.78 77.1979 93.0492 77.1979 94.6945C77.1979 96.3398 78.4171 97.6091 80.0113 97.6091C81.6524 97.6091 82.8246 96.3398 82.8246 94.6945ZM85.4973 90.9809H87.7011C89.1546 90.9809 90.0924 91.827 90.0924 93.0962C90.0924 93.9894 89.6235 94.8826 88.3106 95.1176L90.8895 98.4552H89.7173L87.2322 95.2116H86.4351V98.4552H85.4973V90.9809ZM87.6542 94.3185C88.6388 94.3185 89.1077 93.8484 89.1077 93.0962C89.1077 92.2971 88.5919 91.874 87.6542 91.874H86.4351V94.3655H87.6542V94.3185ZM93.5153 91.874H91.4053V90.9339H96.6099V91.874H94.4999V98.4082H93.5622V91.874H93.5153ZM98.0635 90.9809H99.0013V94.1774H103.127V90.9809H104.065V98.4552H103.127V95.1176H99.0013V98.4552H98.0635V90.9809ZM106.41 90.9809H110.723V91.921H107.394V94.1774H110.114V95.1176H107.394V97.5621H110.723V98.5022H106.41V90.9809ZM112.552 90.9809H114.756C116.209 90.9809 117.147 91.827 117.147 93.0962C117.147 93.9894 116.678 94.8826 115.365 95.1176L117.944 98.4552H116.772L114.287 95.2116H113.49V98.4552H112.552V90.9809ZM114.709 94.3185C115.694 94.3185 116.163 93.8484 116.163 93.0962C116.163 92.2971 115.647 91.874 114.709 91.874H113.49V94.3655H114.709V94.3185ZM120.336 93.1433V98.4552H119.398V90.8868L124.696 96.2928V90.9809H125.634V98.5492L120.336 93.1433ZM131.448 90.9809H132.386V98.4552H131.448V90.9809ZM134.731 90.9809H136.934C138.388 90.9809 139.326 91.827 139.326 93.0962C139.326 93.9894 138.857 94.8826 137.544 95.1176L140.123 98.4552H138.951L136.465 95.2116H135.668V98.4552H134.731V90.9809ZM136.887 94.3185C137.872 94.3185 138.341 93.8484 138.341 93.0962C138.341 92.2971 137.825 91.874 136.887 91.874H135.668V94.3655H136.887V94.3185ZM141.576 90.9809H145.89V91.921H142.561V94.1774H145.281V95.1176H142.561V97.5621H145.89V98.5022H141.576V90.9809ZM147.672 90.9809H148.61V97.5151H151.892V98.4552H147.672V90.9809ZM156.487 90.8868L160.097 98.4552H159.066L158.128 96.4809H154.752L153.814 98.4552H152.783L156.487 90.8868ZM157.753 95.5877L156.487 92.9082L155.221 95.5877H157.753ZM162.442 93.1433V98.4552H161.504V90.8868L166.803 96.2928V90.9809H167.74V98.5492L162.442 93.1433ZM170.038 90.9809H172.242C174.539 90.9809 176.227 92.5792 176.227 94.6945C176.227 96.8099 174.539 98.4082 172.242 98.4082H170.038V90.9809ZM172.289 97.5621C174.07 97.5621 175.289 96.3398 175.289 94.7415C175.289 93.1433 174.07 91.921 172.289 91.921H171.023V97.6091H172.289V97.5621ZM57.8797 96.3869C57.8797 95.3057 58.6768 94.6945 59.4739 94.2715L59.5208 94.2245C59.0988 93.8014 58.6299 93.2373 58.6299 92.5321C58.6299 91.545 59.4739 90.8398 60.5055 90.8398C61.5839 90.8398 62.3342 91.639 62.3342 92.5792C62.3342 93.5193 61.6308 94.0364 60.8806 94.4125L62.4748 95.9638L63.2719 94.9296L63.8346 95.4937L63.0375 96.5279L64.9599 98.4082H63.7877L62.5217 97.139C61.7246 98.0322 61.0682 98.5022 60.1304 98.5022C58.7706 98.5492 57.8797 97.6091 57.8797 96.3869ZM60.1773 97.7031C60.8337 97.7031 61.3964 97.327 61.9591 96.6219L60.0835 94.7886L59.9428 94.8826C59.1926 95.2586 58.7706 95.6817 58.7706 96.3869C58.7706 97.233 59.4739 97.7031 60.1773 97.7031ZM60.3179 93.8484H60.3648C60.9744 93.5663 61.4433 93.2373 61.4433 92.6732C61.4433 92.0621 61.0682 91.686 60.4586 91.686C59.9428 91.686 59.4739 92.0151 59.4739 92.6262C59.4739 93.0492 59.8491 93.3783 60.3179 93.8484Z" fill="white"/>
                        <path d="M28.621 64.7021C28.3865 64.5611 28.1521 64.373 27.9645 64.279C26.9799 63.7619 25.8545 63.5269 24.4948 63.5269C20.4154 63.5269 17.3208 66.8645 17.3208 70.9072C17.3208 74.997 20.4154 78.2876 24.4948 78.2876C26.5579 78.2876 28.1521 77.8645 29.3243 77.0183V73.1166H24.0728L23.979 68.5568H34.0132V79.2277C31.8563 81.6722 28.4803 82.9414 24.4948 82.9414C17.8365 82.9414 12.4912 77.5824 12.4912 70.9072C12.4912 64.232 17.8365 58.873 24.4948 58.873C27.777 58.873 30.5434 60.0013 32.6534 61.9286C32.7941 62.0696 32.9817 62.2577 33.1223 62.3987L28.621 64.7021ZM38.0457 59.2021H46.5325C50.5181 59.2021 53.6128 62.2577 53.6128 66.1124C53.6128 69.0739 51.7372 71.7064 48.877 72.6465L56.6137 82.7534H50.8463L43.4848 73.0226H42.8752V82.7534H38.0925V59.2021H38.0457ZM45.9699 68.9329C47.7517 68.9329 48.9239 67.8047 48.9239 66.3004C48.9239 64.7491 47.7517 63.6209 45.9699 63.6209H42.8283V68.9799H45.9699V68.9329ZM58.8174 59.2021H73.1654V63.95H63.6001V68.6038H71.1961V73.2576H63.6001V78.0525H73.1654V82.7534H58.8174V59.2021ZM86.9039 58.92L98.4385 82.7534H93.3745L91.4052 78.5696H82.3557L80.3863 82.7534H75.3223L86.9039 58.92ZM89.4359 74.5739L86.8101 68.9329L84.1843 74.5739H89.4359ZM100.971 63.95H95.1094V59.2021H111.661V63.95H105.753V82.7534H100.971V63.95Z" fill="white"/>
                        <path class="great-header__great-logo-path--horizontal-reverse" d="M123.384 59.2031L125.775 63.951H199.719V59.2031H123.384Z" fill="url(#paint0_linear_6737_4942)"/>
                        <path class="great-header__great-logo-path--vertical" d="M128.119 0.300781H123.384V23.8521V47.4033L128.119 45.0529V0.300781Z" fill="url(#paint1_linear_6737_4942)"/>
                        <path class="great-header__great-logo-path--horizontal-reverse" d="M187.996 42.6562H125.775L123.384 47.4041H187.996V42.6562Z" fill="url(#paint2_linear_6737_4942)"/>
                        <path class="great-header__great-logo-path--vertical" d="M111.661 12.0996H106.926V45.0526L111.661 47.403V12.0996Z" fill="url(#paint3_linear_6737_4942)"/>
                        <path class="great-header__great-logo-path--horizontal" d="M0.722168 42.6562H109.27L111.661 47.4041H0.722168V42.6562Z" fill="url(#paint4_linear_6737_4942)"/>
                        <path d="M128.119 82.7544H123.384V59.2031L128.119 61.5536V82.7544Z" fill="white"/>
                        <defs>
                            <linearGradient id="paint0_linear_6737_4942" x1="199.741" y1="61.5565" x2="123.396" y2="61.5565" gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0"/>
                            <stop offset="0.303" stop-color="white"/>
                            </linearGradient>
                            <linearGradient id="paint1_linear_6737_4942" x1="125.761" y1="0.307127" x2="125.761" y2="47.4088" gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0"/>
                            <stop offset="0.4921" stop-color="white"/>
                            </linearGradient>
                            <linearGradient id="paint2_linear_6737_4942" x1="187.996" y1="45.0379" x2="123.396" y2="45.0379" gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0"/>
                            <stop offset="0.1762" stop-color="white"/>
                            </linearGradient>
                            <linearGradient id="paint3_linear_6737_4942" x1="109.285" y1="12.0822" x2="109.285" y2="47.4085" gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0"/>
                            <stop offset="0.3227" stop-color="white"/>
                            </linearGradient>
                            <linearGradient id="paint4_linear_6737_4942" x1="0.710821" y1="45.0379" x2="111.65" y2="45.0379" gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0"/>
                            <stop offset="0.5188" stop-color="white"/>
                            </linearGradient>
                            <linearGradient id="logo-gradient-vertical" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:black;stop-opacity:0" />
                                <stop offset="50%" style="stop-color:black;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="logo-gradient-horizontal" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="10%" style="stop-color:black;stop-opacity:0" />
                                <stop offset="50%" style="stop-color:black;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="logo-gradient-horizontal-reverse" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="70%" style="stop-color:black;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:black;stop-opacity:0" />
                            </linearGradient>
                        </defs>     
                    </svg>
                </a>
            </div>
            <div class="great-header__nav-container">
                {% if params.actionLinkList %}
                    <div class="great-header__nav-action">
                        {% for item in params.actionLinkList %}
                            {% if (item.requiresAuth and params.isAuthenticated) or (item.requiresNoAuth and not params.isAuthenticated) %}
                                <a href="{{ item.href }}" class="great-header__action-link">{{ item.text }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="great-header__nav-lower">
                    <nav class="great-header__nav">
                        <ul class="great-header__nav-list">
                            {% for item in params.navItemsList %}
                                {% if (item.requiresAuth and params.isAuthenticated) or (item.requiresNoAuth and not params.isAuthenticated) or (not item.requiresAuth and not item.requiresNoAuth) %}
                                    <li class="great-header__nav-item">
                                        <a href="{{ item.href }}" class="great-header__nav-link{% if item.isCurrent %} great-header__nav-link--current{% endif %}">{{ item.text }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </nav>
                    {% if not params.hideSearch %}
                    <div class="great-header__search">
                        <form id="great-header-search-form" class="great-header__search-form" action="/" method="get">
                            {{ textInput({
                                classes: "great-text-input--search",
                                id: "great-header-search-input",
                                label: "Search",
                                name: "search",
                                placeholder: "Search",
                                labelClasses: "govuk-visually-hidden"
                            }) }}
                            
                            {{ greatButton({
                                classes: "great-button--icon great-button--search",
                                text: "Search",
                                html: '<svg xmlns="http://www.w3.org/2000/svg" class="great-icon--svg" width="20" height="20" viewBox="0 0 18 18" fill="currentColor">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.77589 13.722C6.26697 13.8589 4.79933 13.386 3.64011 12.4016C1.2472 10.3681 0.933108 6.74217 2.94069 4.31856C4.06024 2.96784 5.66793 2.27198 7.28695 2.27198C8.57164 2.27198 9.86443 2.7113 10.9249 3.61205C12.0841 4.59641 12.7949 5.97992 12.9268 7.50687C13.0588 9.03299 12.5957 10.5206 11.6235 11.6943C10.6505 12.868 9.28401 13.5884 7.77589 13.722ZM18 15.5071L13.5606 11.7361C14.3256 10.4247 14.6737 8.91169 14.5393 7.36344C14.3702 5.40128 13.4562 3.62271 11.9651 2.35558C8.88816 -0.258992 4.28286 0.148357 1.70133 3.26536C-0.881003 6.38072 -0.477867 11.0427 2.59908 13.6573C3.92344 14.7826 5.56107 15.3834 7.26914 15.3834C7.48447 15.3834 7.70061 15.3744 7.91756 15.3555C9.44591 15.2203 10.8569 14.6097 11.9999 13.6196L16.4385 17.3914L18 15.5071Z"/>
                                </svg>'
                            }) }}
                        </form>
                    </div>
                    {% endif %}
                    <div class="great-header__menu">
                        {{ greatButton({
                            text: "Menu",
                            classes: "great-button--inverted great-button--icon-prefix great-button--auto-width govuk-!-margin-left-3",
                            attributes: "data-reveal-button data-reveal-modal aria-controls=header-menu",
                            iconPrefix: '<svg class="great-icon--svg" width="16" height="17" viewBox="0 0 16 17" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 3.5C1 2.94687 1.44687 2.5 2 2.5H14C14.5531 2.5 15 2.94687 15 3.5C15 4.05313 14.5531 4.5 14 4.5H2C1.44687 4.5 1 4.05313 1 3.5ZM1 8.5C1 7.94688 1.44687 7.5 2 7.5H14C14.5531 7.5 15 7.94688 15 8.5C15 9.05312 14.5531 9.5 14 9.5H2C1.44687 9.5 1 9.05312 1 8.5ZM15 13.5C15 14.0531 14.5531 14.5 14 14.5H2C1.44687 14.5 1 14.0531 1 13.5C1 12.9469 1.44687 12.5 2 12.5H14C14.5531 12.5 15 12.9469 15 13.5Z"/>
                            </svg>'
                        }) }}

                        <ul id="header-menu" class="great-header__menu-list">
                            {% for item in params.menuItemsList %}
                                {% if (item.requiresAuth and params.isAuthenticated) or (item.requiresNoAuth and not params.isAuthenticated) or (not item.requiresAuth and not item.requiresNoAuth) %}
                                    <li class="great-header__menu-item{% if item.userGreeting %} great-header__menu-item--user{% endif %}">
                                        {% if item.href and not item.button %}
                                            <a href="{{ item.href }}" class="great-header__menu-link">{{ item.text }}</a>
                                        {% elif item.button %}
                                            {{ greatButton({
                                                text: item.text,
                                                classes: "great-button--full-width govuk-!-margin-0",
                                                href: item.href
                                            }) }}
                                        {% else %}
                                            {{ item.text }}
                                        {% endif %}
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
{% endmacro %}